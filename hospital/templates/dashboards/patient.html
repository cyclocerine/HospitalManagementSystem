{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
        <div class="flex justify-between items-start">
            <div>
                <h1 class="text-4xl font-bold text-gray-900">Halo, {{ patient.name }}</h1>
                <p class="text-gray-600 mt-2">Nomor Rekam Medis: <span class="font-semibold text-blue-600">#RM-{{ patient.id|stringformat:"05d" }}</span></p>
                <p class="text-gray-600">Jenis Kelamin: <span class="font-semibold">{{ patient.gender }}</span> | Golongan Darah: <span class="font-semibold">{{ patient.blood_type|default:"--" }}</span></p>
            </div>
            <div class="text-right">
                <p class="text-sm text-gray-500">Waktu: <span id="current-time"></span></p>
                <a href="/accounts/logout/" class="mt-4 inline-block bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition">
                    Logout
                </a>
            </div>
        </div>
    </div>

    <!-- Status Rawat Inap Alert -->
    {% if inpatient_status %}
    <div class="bg-yellow-50 border-l-4 border-yellow-500 p-6 rounded-lg mb-8 shadow">
        <h3 class="text-lg font-semibold text-yellow-800 mb-2">‚ö†Ô∏è Anda Sedang Dirawat Inap</h3>
        <p class="text-yellow-700">
            Ruang: <strong>{{ inpatient_status.room.name }}</strong> ({{ inpatient_status.room.room_type }}) | 
            Tgl Masuk: <strong>{{ inpatient_status.admission_date|date:"d M Y" }}</strong>
        </p>
    </div>
    {% endif %}

    <!-- Statistik Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="bg-blue-50 p-6 rounded-lg border-l-4 border-blue-500 shadow">
            <h3 class="text-gray-600 text-sm font-semibold">Rekam Medis</h3>
            <p class="text-4xl font-bold text-blue-600 mt-2">{{ total_records }}</p>
            <p class="text-xs text-gray-500 mt-2">Total kunjungan</p>
        </div>
        
        <div class="bg-green-50 p-6 rounded-lg border-l-4 border-green-500 shadow">
            <h3 class="text-gray-600 text-sm font-semibold">Resep Aktif</h3>
            <p class="text-4xl font-bold text-green-600 mt-2">{{ total_prescriptions }}</p>
            <p class="text-xs text-gray-500 mt-2">Obat yang diminum</p>
        </div>
        
        <div class="bg-purple-50 p-6 rounded-lg border-l-4 border-purple-500 shadow">
            <h3 class="text-gray-600 text-sm font-semibold">Telepon</h3>
            <p class="text-lg font-semibold text-purple-600 mt-2">{{ patient.phone }}</p>
            <p class="text-xs text-gray-500 mt-2">Hubungi rumah sakit</p>
        </div>

        <div class="bg-pink-50 p-6 rounded-lg border-l-4 border-pink-500 shadow">
            <h3 class="text-gray-600 text-sm font-semibold">BPJS</h3>
            <p class="text-sm font-semibold text-pink-600 mt-2">{{ patient.bpjs_status|default:"Tidak Terdaftar" }}</p>
            <p class="text-xs text-gray-500 mt-2">Status asuransi</p>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-8">
            <!-- Form Buat Appointment -->
            <div class="bg-white rounded-lg shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">üìÖ Buat Janji Temu</h2>
                <form method="POST" class="space-y-6">
                    {% csrf_token %}
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-3">Pilih Dokter Spesialis</label>
                            <select name="doctor" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                <option value="">-- Pilih Dokter --</option>
                                {% for doctor in doctors %}
                                    <option value="{{ doctor.id }}">
                                        Dr. {{ doctor.name }} ({{ doctor.specialty }})
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-3">Tanggal Janji</label>
                            <input 
                                type="date" 
                                name="date" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                required
                                min="{% now 'Y-m-d' %}"
                            >
                        </div>
                    </div>
                    <button 
                        type="submit" 
                        class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition shadow-md"
                    >
                        ‚úì Buat Janji Temu
                    </button>
                </form>
            </div>

            <!-- Rekam Medis -->
            <div class="bg-white rounded-lg shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">üìã Riwayat Rekam Medis</h2>
                
                {% if medical_records %}
                <div class="space-y-4">
                    {% for record in medical_records %}
                    <div class="border border-gray-200 rounded-lg p-6 hover:shadow-md transition">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <div>
                                <p class="text-xs text-gray-500 uppercase font-semibold">Tanggal Pemeriksaan</p>
                                <p class="text-lg font-bold text-gray-900">{{ record.examination_date|date:"d M Y" }}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 uppercase font-semibold">Dokter</p>
                                <p class="text-lg font-bold text-gray-900">Dr. {{ record.doctor.name }}</p>
                                <p class="text-xs text-gray-600">{{ record.doctor.specialty }}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 uppercase font-semibold">Unit</p>
                                <p class="text-lg font-bold text-gray-900">{{ record.doctor.unit }}</p>
                            </div>
                            <div class="text-right">
                                <a href="/admin/core/medicalrecord/{{ record.id }}/change/" class="inline-block bg-blue-100 text-blue-700 px-4 py-2 rounded-lg hover:bg-blue-200 transition font-medium">
                                    Lihat Detail
                                </a>
                            </div>
                        </div>
                        
                        {% if record.diagnosis %}
                        <div class="bg-red-50 border-l-2 border-red-500 p-4 mb-3 rounded">
                            <p class="text-xs text-red-600 uppercase font-semibold">Diagnosis</p>
                            <p class="text-gray-900 mt-1">{{ record.diagnosis }}</p>
                        </div>
                        {% endif %}
                        
                        {% if record.treatment %}
                        <div class="bg-green-50 border-l-2 border-green-500 p-4 rounded">
                            <p class="text-xs text-green-600 uppercase font-semibold">Penanganan / Obat</p>
                            <p class="text-gray-900 mt-1">{{ record.treatment }}</p>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-12">
                    <p class="text-gray-500 text-lg">Belum ada rekam medis. Silakan buat janji temu pertama Anda.</p>
                </div>
                {% endif %}
            </div>

            <!-- Resep Obat -->
            {% if prescriptions %}
            <div class="bg-white rounded-lg shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">üíä Resep Obat Terbaru</h2>
                
                <div class="space-y-4">
                    {% for prescription in prescriptions %}
                    <div class="border-l-4 border-green-500 bg-green-50 p-6 rounded-lg">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <p class="font-bold text-lg text-gray-900">{{ prescription.medicine.name }}</p>
                                <p class="text-sm text-gray-600 mt-1">
                                    Golongan: {{ prescription.medicine.medicine_class }} | 
                                    Jenis: {{ prescription.medicine.medicine_type }}
                                </p>
                            </div>
                            <span class="text-xs bg-green-200 text-green-800 px-3 py-1 rounded-full font-semibold">
                                {{ prescription.prescription_date|date:"d/m/Y" }}
                            </span>
                        </div>
                        
                        <div class="bg-white rounded p-4 mt-4 border border-green-200">
                            <p class="text-sm">
                                <span class="font-semibold text-gray-900">Dosis:</span> 
                                <span class="text-gray-700">{{ prescription.dosage }}</span>
                            </p>
                            {% if prescription.notes %}
                            <p class="text-sm mt-2">
                                <span class="font-semibold text-gray-900">Catatan:</span> 
                                <span class="text-gray-700 italic">{{ prescription.notes }}</span>
                            </p>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="space-y-8">
            <!-- Info Pribadi -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">üë§ Data Pribadi</h3>
                <div class="space-y-3 text-sm">
                    <div class="border-b border-gray-200 pb-3">
                        <p class="text-gray-600">Nama Lengkap</p>
                        <p class="font-semibold text-gray-900">{{ patient.name }}</p>
                    </div>
                    <div class="border-b border-gray-200 pb-3">
                        <p class="text-gray-600">Tanggal Lahir</p>
                        <p class="font-semibold text-gray-900">{{ patient.date_of_birth|date:"d M Y" }}</p>
                    </div>
                    <div class="border-b border-gray-200 pb-3">
                        <p class="text-gray-600">Alamat</p>
                        <p class="font-semibold text-gray-900">{{ patient.address|default:"--" }}</p>
                    </div>
                    <div class="border-b border-gray-200 pb-3">
                        <p class="text-gray-600">Telepon</p>
                        <p class="font-semibold text-gray-900">{{ patient.phone }}</p>
                    </div>
                    <div>
                        <p class="text-gray-600">Golongan Darah</p>
                        <p class="font-semibold text-gray-900">{{ patient.blood_type|default:"--" }}</p>
                    </div>
                </div>
            </div>

            <!-- Daftar Dokter Favorit -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">‚≠ê Dokter</h3>
                <div class="space-y-3">
                    {% for doctor in doctors %}
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-3 rounded-lg border border-blue-200 hover:shadow transition">
                        <p class="font-semibold text-gray-900">Dr. {{ doctor.name }}</p>
                        <p class="text-xs text-gray-600 mt-1">{{ doctor.specialty }}</p>
                        <p class="text-xs text-gray-500 mt-1">{{ doctor.unit }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Tips Kesehatan -->
            <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg shadow-lg p-6 border border-green-200">
                <h3 class="text-lg font-bold text-gray-900 mb-4">üí° Tips Kesehatan</h3>
                <ul class="space-y-2 text-sm text-gray-700">
                    <li class="flex items-start">
                        <span class="text-green-600 mr-2">‚úì</span>
                        <span>Minum air putih minimal 8 gelas per hari</span>
                    </li>
                    <li class="flex items-start">
                        <span class="text-green-600 mr-2">‚úì</span>
                        <span>Olahraga rutin 30 menit setiap hari</span>
                    </li>
                    <li class="flex items-start">
                        <span class="text-green-600 mr-2">‚úì</span>
                        <span>Tidur cukup 7-8 jam per malam</span>
                    </li>
                    <li class="flex items-start">
                        <span class="text-green-600 mr-2">‚úì</span>
                        <span>Hindari makanan berkolesterol tinggi</span>
                    </li>
                    <li class="flex items-start">
                        <span class="text-green-600 mr-2">‚úì</span>
                        <span>Minum obat sesuai dosis dokter</span>
                    </li>
                </ul>
            </div>

            <!-- Kontak Darurat -->
            <div class="bg-red-50 rounded-lg shadow-lg p-6 border-l-4 border-red-500">
                <h3 class="text-lg font-bold text-red-900 mb-4">üö® Kontak Darurat</h3>
                <div class="space-y-2 text-sm">
                    <p>
                        <span class="font-semibold text-gray-900">Ambulans:</span>
                        <span class="text-red-700">(021) 1234-5678</span>
                    </p>
                    <p>
                        <span class="font-semibold text-gray-900">IGD:</span>
                        <span class="text-red-700">(021) 8765-4321</span>
                    </p>
                    <p>
                        <span class="font-semibold text-gray-900">Jam Layanan:</span>
                        <span class="text-gray-700">24 Jam</span>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Update waktu real-time
    function updateTime() {
        const now = new Date();
        const options = { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false,
            timeZone: 'Asia/Jakarta'
        };
        const formatter = new Intl.DateTimeFormat('id-ID', options);
        document.getElementById('current-time').textContent = formatter.format(now);
    }
    
    updateTime();
    setInterval(updateTime, 1000);
</script>
{% endblock %}
